<html>
<head>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            width: 100%;
            height: 100%;
            background-color: #000;
            overflow: hidden;
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    var width = canvas.width = window.innerWidth;
    var height = canvas.height = window.innerHeight;
    context.font = "12px Georgia ";
    context.strokeStyle = "#ffffff";
    var cubes = [];
    var circles = [];
    var dots = [];
    var cubeSize = 20;
    var column = Math.floor(width / cubeSize);
    var row = Math.floor(height / cubeSize);
    var cubeTypes = [];

    function Cube(lt, rt, lb, rb) {
        this.lt = lt;
        this.rt = rt;
        this.lb = lb;
        this.rb = rb;
        this.typeArr = [];
        if (this.lt.potential > 1) {
            this.typeArr.push(1);
        } else {
            this.typeArr.push(0);
        }
        if (this.rt.potential > 1) {
            this.typeArr.push(1);
        } else {
            this.typeArr.push(0);
        }
        if (this.rb.potential > 1) {
            this.typeArr.push(1);
        } else {
            this.typeArr.push(0);
        }
        if (this.lb.potential > 1) {
            this.typeArr.push(1);
        } else {
            this.typeArr.push(0);
        }
        this.type = parseInt(this.typeArr.join(''), 2);
    }
    Cube.prototype.draw = function () {
        context.beginPath();
        switch (this.type) {
            case 0:
                break;
            case 1:
                context.moveTo(this.lt.x, (this.lb.y + this.lt.y) / 2);
                context.lineTo((this.rb.x + this.lb.x) / 2, this.lb.y);
                break;
            case 2:
                context.moveTo(this.rt.x, (this.rb.y + this.rt.y) / 2);
                context.lineTo((this.rb.x + this.lb.x) / 2, this.lb.y);
                break;
            case 3:
                context.moveTo(this.lt.x, (this.lb.y + this.lt.y) / 2);
                context.lineTo(this.rt.x, (this.rb.y + this.rt.y) / 2);
                break;
            case 4:
                context.moveTo((this.rt.x + this.lt.x) / 2, this.rt.y);
                context.lineTo(this.rt.x, (this.rb.y + this.rt.y) / 2);
                break;
            case 5:
                context.moveTo(this.lt.x, (this.lb.y + this.lt.y) / 2);
                context.lineTo((this.rt.x + this.lt.x) / 2, this.rt.y);
                context.moveTo(this.rt.x, (this.rb.y + this.rt.y) / 2);
                context.lineTo((this.rb.x + this.lb.x) / 2, this.lb.y);
                break;
            case 6:
                context.moveTo((this.rt.x + this.lt.x) / 2, this.rt.y);
                context.lineTo((this.rb.x + this.lb.x) / 2, this.rb.y);
                break;
            case 7:
                context.moveTo(this.lt.x, (this.lb.y + this.lt.y) / 2);
                context.lineTo((this.rt.x + this.lt.x) / 2, this.rt.y);
                break;
            case 8:
                context.moveTo(this.lt.x, (this.lb.y + this.lt.y) / 2);
                context.lineTo((this.rt.x + this.lt.x) / 2, this.rt.y);
                break;
            case 9:
                context.moveTo((this.rt.x - this.lt.x) / 2, this.rt.y);
                context.lineTo((this.rb.x - this.lb.x) / 2, this.rb.y);
                break;
            case 10:
                context.moveTo((this.rt.x - this.lt.x) / 2, this.rt.y);
                context.lineTo(this.rt.x, (this.rb.y - this.rt.y) / 2);
                context.moveTo(this.lt.x, (this.lb.y - this.lt.y) / 2);
                context.lineTo((this.rb.x - this.lb.x) / 2, this.lb.y);
                break;
            case 11:
                context.moveTo((this.rt.x - this.lt.x) / 2, this.rt.y);
                context.lineTo(this.rt.x, (this.rb.y - this.rt.y) / 2);
                break;
            case 12:
                context.moveTo(this.lt.x, (this.lb.y - this.lt.y) / 2);
                context.lineTo(this.rt.x, (this.rb.y - this.rt.y) / 2);
                break;
            case 13:
                context.moveTo(this.rt.x, (this.rb.y - this.rt.y) / 2);
                context.lineTo((this.rb.x - this.lb.x) / 2, this.lb.y);
                break;
            case 14:
                context.moveTo(this.lt.x, (this.lb.y - this.lt.y) / 2);
                context.lineTo((this.rb.x - this.lb.x) / 2, this.lb.y);
                break;
            case 15:
                break;
            break;
        }
        context.stroke();
    };

    function Dot(x, y) {
        this.x = x;
        this.y = y;
        this.potential = 0;
    }

    Dot.prototype.set = function (x, y) {
        this.x = x;
        this.y = y;
    };

    Dot.prototype.update = function () {
        this.potential = calmPotential(this.x, this.y);
    };

    function Circle() {
        this.x = Math.random() * width;
        this.y = Math.random() * height;
        this.r = 20 + Math.random() * 20;
        this.vx = -2 + Math.random() * 4;
        this.vy = -2 + Math.random() * 4;
    }
    Circle.prototype.update = function () {
        if (this.x + this.r > width || this.x - this.r < 0) {
            this.vx = -this.vx;
        } else if (this.y + this.r > height || this.y - this.r < 0) {
            this.vy = -this.vy;
        }
        this.x += this.vx;
        this.y += this.vy;
    };
    function calmPotential(x, y) {
        var potential = 0;
        for (var i = 0; i < circles.length; i++) {
            var circle = circles[i];
            potential += (circle.r * circle.r) / ((x - circle.x) * (x - circle.x) + (y - circle.y) * (y - circle.y));
        }
        return potential;
    }

    for (var i = 0; i < 5; i++) {
        circles.push(new Circle());
    }

    //点阵,从上到下,从左到右
    for (var i = 0; i < width; i += cubeSize) {
        var arr = [];
        for (var j = 0; j < height; j += cubeSize) {
            var dot = new Dot(i, j);
            dot.update();
            arr.push(dot);
        }
        dots.push(arr);
    }


    for (var i = 0; i < column; i++) {
        for (var j = 0; j < row; j++) {
            try {
                var lt = dots[i][j];
                var rt = dots[i + 1][j];
                var lb = dots[i][j + 1];
                var rb = dots[i + 1][j + 1];
                var cube = new Cube(lt, rt, lb, rb);
                cubes.push(cube);

            } catch (e) {
            }
            cube.draw();

        }
    }

    //    context.clearRect(0, 0, width, height);
    for (var i = 0; i < circles.length; i++) {
        context.strokeStyle = "#ffffff";
        context.beginPath();
        context.arc(circles[i].x, circles[i].y, circles[i].r, 0, Math.PI * 2);
        context.stroke();
    }
</script>
</body>
</html>
